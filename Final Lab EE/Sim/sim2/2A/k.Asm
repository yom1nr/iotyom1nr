kDelay EQU 1
; if Run on board >> kDelay EQU 25
; if SimmulaOon >> kDelay EQU 1
LF_SEG EQU P1.4
RG_SEG EQU P1.5
PT_SEG EQU P0
pData EQU P2.7
pClock EQU P2.6
pLatch EQU P2.5
 ORG 0000H
 JMP 0100H

 ORG 0100H
 MOV SP,#2FH
 CLR LF_SEG
 CLR RG_SEG

LOOP: MOV DPTR,#0001H
 CALL Send16_LED
 MOV DPTR,#0002H
 CALL Send16_LED
 MOV DPTR,#0004H
 CALL Send16_LED
 MOV DPTR,#0008H
 CALL Send16_LED
 MOV DPTR,#0010H
 CALL Send16_LED
 MOV DPTR,#0020H
 CALL Send16_LED
 MOV DPTR,#0040H
 CALL Send16_LED
 MOV DPTR,#0080H
 CALL Send16_LED
 MOV DPTR,#0100H
 CALL Send16_LED
 MOV DPTR,#0200H
 CALL Send16_LED
 MOV DPTR,#0400H
 CALL Send16_LED
 MOV DPTR,#0800H
 CALL Send16_LED
 MOV DPTR,#1000H
 CALL Send16_LED
 MOV DPTR,#2000H
 CALL Send16_LED
 MOV DPTR,#4000H
 CALL Send16_LED
 MOV DPTR,#8000H
 CALL Send16_LED
 JMP LOOP 
 
 Send16_LED:
 MOV A,DPL
 CALL ShiO8
 MOV A,DPH
 CALL ShiO8
 CLR pLatch
 SETB pLatch
 CALL Display_DPTR
 MOV R7,#10
_Wait0: MOV R6,#kDelay
_Wait1: CALL DELAY
 DJNZ R6,_Wait1
 DJNZ R7,_Wait0
 RET
ShiO8: MOV B,#8
_ShiO: RRC A
 MOV pData,C
 CLR pClock
 SETB pClock
 DJNZ B,_ShiO
 RET
Display_DPTR:
 MOV A,#10H
 CALL _Send1Seg
 MOV A,DPH
 CALL _Send2HEX
 MOV A,DPL
 CALL _Send2HEX
 RET
_Send2HEX:
 PUSH Acc
 SWAP A
 CALL _Send1HEX
 POP Acc
_Send1HEX:
 ANL A,#0FH
_Send1Seg:
 PUSH DPH
 PUSH DPL
 MOV DPTR,#T_SEG
 MOVC A,@A+DPTR
 CPL A
 MOV PT_SEG,A
 POP DPL
 POP DPH
 MOV R7,#kDelay
_Wait2: CALL DELAY
 DJNZ R7,_Wait2
 MOV PT_SEG,#0FFH
 MOV R7,#kDelay
_Wait3: CALL DELAY
 DJNZ R7,_Wait3
 RET
T_SEG: DB 77H, 11H, 6DH, 5DH, 1BH, 5EH, 7EH, 15H ; Code 0123 4567
 DB 7FH, 5FH, 3FH, 7AH, 66H, 79H, 6EH, 2EH ; Code 89ab cdef
 DB 08H 

Delay: MOV B,#kDelay
 MOV A,#250
_DLY00: DJNZ Acc,_DLY00
 DJNZ B,_DLY00
 RET
 END